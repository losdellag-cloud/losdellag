<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Los del Lag — Comunidad Minecraft</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass {
      background: linear-gradient(to bottom right, rgba(16,185,129,.15), rgba(16,185,129,.05));
      backdrop-filter: blur(6px);
    }
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-100">
  <!-- NAV -->
  <header class="sticky top-0 z-40 border-b border-neutral-800/60 bg-neutral-950/75 backdrop-blur">
    <nav class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <img alt="Logo" class="w-8 h-8 rounded" src="https://upload.wikimedia.org/wikipedia/commons/5/51/Minecraft_face.png">
        <span class="font-bold">Los del Lag</span>
      </div>
      <div class="hidden md:flex gap-2 text-sm">
        <a class="px-3 py-2 rounded hover:bg-neutral-800" href="#anuncios">Anuncios</a>
        <a class="px-3 py-2 rounded hover:bg-neutral-800" href="#eventos">Eventos</a>
        <a class="px-3 py-2 rounded hover:bg-neutral-800" href="#staff">Equipo</a>
        <a class="px-3 py-2 rounded hover:bg-neutral-800" href="#galeria">Galería</a>
        <a class="px-3 py-2 rounded hover:bg-neutral-800" href="#comunidad">Comunidad</a>
        <a class="px-3 py-2 rounded hover:bg-neutral-800" href="#join">Cómo entrar</a>
        <a class="px-3 py-2 rounded hover:bg-neutral-800" href="#normas">Normas</a>
        <a class="ml-1 bg-emerald-600 hover:bg-emerald-500 text-black font-semibold px-3 py-2 rounded"
           target="_blank" href="#discord">Discord</a>
      </div>
    </nav>
  </header>

  <!-- HERO -->
  <section class="relative">
    <div class="absolute inset-0 bg-gradient-to-b from-emerald-600/10 to-transparent"></div>
    <div class="max-w-6xl mx-auto px-4 py-14">
      <div class="text-center space-y-4">
        <span class="text-xs uppercase tracking-widest text-emerald-400/90">Comunidad Minecraft</span>
        <h1 class="text-3xl md:text-5xl font-extrabold">Rompe el lag y juega con nosotros</h1>

        <p class="text-neutral-300 max-w-2xl mx-auto">
          Eventos, construcciones y buen rollo. ¡Únete al Discord y entra al servidor!
        </p>

        <div class="flex flex-wrap items-center justify-center gap-3 pt-2">
          <a class="bg-emerald-600 hover:bg-emerald-500 text-black font-semibold px-5 py-3 rounded-lg"
             id="btn-discord" target="_blank" href="#discord">Unirme al Discord</a>
          <a class="border border-neutral-700 hover:bg-neutral-800 px-5 py-3 rounded-lg" href="#eventos">Ver eventos</a>
          <a class="border border-neutral-700 hover:bg-neutral-800 px-5 py-3 rounded-lg" href="#join">Cómo entrar</a>
        </div>

        <p class="text-sm text-neutral-400">
          Servidor: <b id="server-ip">mc.tuservidor.xyz</b> • 
          Versión <b id="server-ver">1.21.x</b> • Modo: Survival + Eventos
        </p>
      </div>
    </div>
  </section>
  <!-- ANUNCIOS -->
  <section id="anuncios" class="max-w-6xl mx-auto px-4 py-10">
    <h2 class="text-2xl font-bold mb-4">Anuncios</h2>

    <div class="grid md:grid-cols-3 gap-4">
      <article class="glass border border-neutral-800 rounded-xl p-4">
        <h3 class="font-semibold">Evento PvP semanal</h3>
        <p class="text-sm text-neutral-300">Sábados 20:00 — Premios top 3. Reglas en #anuncios.</p>
      </article>

      <article class="glass border border-neutral-800 rounded-xl p-4">
        <h3 class="font-semibold">Nuevo Nether</h3>
        <p class="text-sm text-neutral-300">Reinicio limpio y recursos renovados. No greif.</p>
      </article>

      <article class="glass border border-neutral-800 rounded-xl p-4">
        <h3 class="font-semibold">Buscamos creadores</h3>
        <p class="text-sm text-neutral-300">¿Streameas? Habla con staff para rol Creador.</p>
      </article>
    </div>
  </section>

  <!-- EVENTOS -->
  <section id="eventos" class="max-w-6xl mx-auto px-4 py-10 scroll-mt-24">
    <h2 class="text-2xl font-bold mb-4">Eventos</h2>

    <div class="grid md:grid-cols-2 gap-4">
      <div class="border border-neutral-800 rounded-xl p-4">
        <h3 class="font-semibold">Build Battle</h3>
        <p class="text-sm text-neutral-300">Sáb 22/11 • 20:00 • Lobby 2 • 24 cupos</p>
        <a class="mt-2 inline-block bg-emerald-600 hover:bg-emerald-500 text-black font-semibold px-4 py-2 rounded"
           href="#">Inscribirme</a>
      </div>

      <div class="border border-neutral-800 rounded-xl p-4">
        <h3 class="font-semibold">UHC amistoso</h3>
        <p class="text-sm text-neutral-300">Sáb 29/11 • 19:30 • Arena • 40 cupos</p>
        <a class="mt-2 inline-block bg-emerald-600 hover:bg-emerald-500 text-black font-semibold px-4 py-2 rounded"
           href="#">Inscribirme</a>
      </div>
    </div>
  </section>

  <!-- STAFF -->
  <section id="staff" class="max-w-6xl mx-auto px-4 py-10 scroll-mt-24">
    <h2 class="text-2xl font-bold mb-4">Equipo</h2>

    <div class="grid md:grid-cols-3 gap-4">
      <div class="border border-neutral-800 rounded-xl p-4">
        <div class="font-semibold">Alessandro6226</div>
        <div class="text-sm text-neutral-300">Founder • Fundador</div>
      </div>

      <div class="border border-neutral-800 rounded-xl p-4">
        <div class="font-semibold">lujanherb5370</div>
        <div class="text-sm text-neutral-300">Admin</div>
      </div>

      <div class="border border-neutral-800 rounded-xl p-4">
        <div class="font-semibold">Jotavillaxd</div>
        <div class="text-sm text-neutral-300">Staff</div>
      </div>
    </div>
  </section>

  <!-- GALERÍA -->
  <section id="galeria" class="max-w-6xl mx-auto px-4 py-10 scroll-mt-24">
    <h2 class="text-2xl font-bold mb-4">Galería</h2>

    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
      <img class="rounded-lg border border-neutral-800 object-cover aspect-video"
           src="https://picsum.photos/seed/castle/800/450" alt="Castillo medieval">

      <img class="rounded-lg border border-neutral-800 object-cover aspect-video"
           src="https://picsum.photos/seed/redstone/800/450" alt="Redstone">

      <img class="rounded-lg border border-neutral-800 object-cover aspect-video"
           src="https://picsum.photos/seed/nether/800/450" alt="Nether">

      <img class="rounded-lg border border-neutral-800 object-cover aspect-video"
           src="https://picsum.photos/seed/end/800/450" alt="End">
    </div>
  </section>

  <!-- COMUNIDAD -->
  <section id="comunidad" class="max-w-6xl mx-auto px-4 py-10 scroll-mt-24">
    <h2 class="text-2xl font-bold mb-4">Comunidad</h2>

    <div class="flex items-center gap-4 mb-6 text-sm">
      <span id="auth-user" class="text-neutral-300">Visitante</span>

      <div id="auth-buttons" class="flex flex-wrap gap-2"></div>

      <button id="btn-logout"
              class="hidden border border-neutral-700 hover:bg-neutral-800 px-3 py-2 rounded">
        Salir
      </button>
    </div>

    <!-- Formulario -->
    <form id="post-form" class="border border-neutral-800 rounded-xl p-4 grid gap-3 disabled:opacity-60">
      <label class="text-sm text-neutral-300">Mensaje:</label>
      <textarea id="post-text"
                rows="3"
                class="w-full bg-neutral-900 border border-neutral-800 rounded px-3 py-2"
                placeholder="¡Miren mi nueva base!"
                disabled></textarea>

      <label class="text-sm text-neutral-300">Imagen o video (opcional):</label>
      <input id="post-file"
             type="file"
             accept="image/*,video/*"
             class="text-sm"
             disabled />

      <button class="bg-emerald-600 hover:bg-emerald-500 text-black font-semibold px-4 py-2 rounded"
              type="submit"
              disabled>Publicar</button>
    </form>

    <div id="posts" class="mt-6 grid md:grid-cols-2 gap-4"></div>
  </section>

  <!-- CÓMO ENTRAR -->
  <section id="join" class="max-w-6xl mx-auto px-4 py-10">
    <h2 class="text-2xl font-bold mb-4">Cómo entrar al servidor</h2>

    <div class="grid md:grid-cols-2 gap-4 text-sm text-neutral-300">
      <div class="border border-neutral-800 rounded-xl p-4">
        <h3 class="text-white font-semibold mb-2">Java Edition</h3>
        <ol class="list-decimal pl-5 space-y-1">
          <li>Abrí Minecraft <b id="java-ver">1.21.x</b></li>
          <li>Multijugador → Agregar servidor</li>
          <li>IP: <b id="ip-java">mc.tuservidor.xyz</b></li>
        </ol>
      </div>

      <div class="border border-neutral-800 rounded-xl p-4">
        <h3 class="text-white font-semibold mb-2">Bedrock / PE</h3>
        <ol class="list-decimal pl-5 space-y-1">
          <li>Play → Servers → Add Server</li>
          <li>Address: <b id="ip-bedrock">mc.tuservidor.xyz</b></li>
          <li>Port: <b>19132</b></li>
        </ol>
      </div>
    </div>
  </section>

  <!-- NORMAS -->
  <section id="normas" class="max-w-6xl mx-auto px-4 py-10">
    <h2 class="text-2xl font-bold mb-4">Normas básicas</h2>

    <ul class="grid md:grid-cols-2 gap-3 text-sm text-neutral-300">
      <li class="border border-neutral-800 rounded-xl p-4">Respetar a todos. Cero toxicidad.</li>
      <li class="border border-neutral-800 rounded-xl p-4">Prohibido hacks y dupes.</li>
      <li class="border border-neutral-800 rounded-xl p-4">Greif = ban inmediato.</li>
      <li class="border border-neutral-800 rounded-xl p-4">No spam ni publicidad sin permiso.</li>
    </ul>
  </section>
  <!-- FOOTER -->
  <footer class="border-t border-neutral-800">
    <div class="max-w-6xl mx-auto px-4 py-8 text-sm text-neutral-400 flex flex-col md:flex-row items-center justify-between gap-3">
      <div>© <span id="year"></span> Los del Lag. Hecho con ♥</div>

      <div class="flex gap-3">
        <a id="yt" class="hover:text-white" target="_blank" href="#">YouTube</a>
        <a id="tw" class="hover:text-white" target="_blank" href="#">Twitch</a>
        <a id="dc" class="hover:text-white" target="_blank" href="#">Discord</a>
      </div>
    </div>
  </footer>

  <!-- CONFIG -->
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    window.CONFIG = Object.freeze({
      discord: "https://discord.gg/tu-invite",
      youtube: "https://youtube.com/@tucanal",
      twitch: "https://twitch.tv/tucanal",
      ip: "mc.tuservidor.xyz",
      version: "1.21.x"
    });

    document.getElementById("btn-discord").href = CONFIG.discord;
    document.getElementById("dc").href = CONFIG.discord;
    document.getElementById("yt").href = CONFIG.youtube;
    document.getElementById("tw").href = CONFIG.twitch;

    for (const id of ["server-ip", "ip-java", "ip-bedrock"])
      document.getElementById(id).textContent = CONFIG.ip;

    for (const id of ["server-ver", "java-ver"])
      document.getElementById(id).textContent = CONFIG.version;
  </script>

  <!-- SUPABASE -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const SUPABASE_URL = "https://yyzkzodgbbaqiylktsst.supabase.co";   // <-- reemplazar
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5emt6b2RnYmJhcWl5bGt0c3N0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1MTA1ODQsImV4cCI6MjA3OTA4NjU4NH0.sAKbEOsaUR_OQve9GJEep6tmpT6sxS3ePNHfMatPSkY";                      // <-- reemplazar

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

    const postsEl = document.getElementById("posts");
    const formEl = document.getElementById("post-form");
    const textEl = document.getElementById("post-text");
    const fileEl = document.getElementById("post-file");
    const authUserEl = document.getElementById("auth-user");
    const authButtonsEl = document.getElementById("auth-buttons");
    const logoutBtn = document.getElementById("btn-logout");

    const OAUTH_PROVIDERS = [
      { id: "discord", label: "Discord" },
      { id: "google", label: "Google" },
      { id: "github", label: "GitHub" },
      { id: "twitch", label: "Twitch" },
      { id: "twitter", label: "Twitter" },
      { id: "microsoft", label: "Microsoft" },
      { id: "facebook", label: "Facebook" },
      { id: "apple", label: "Apple" }
    ];

    function renderAuthButtons() {
      authButtonsEl.innerHTML = "";
      for (const p of OAUTH_PROVIDERS) {
        const btn = document.createElement("button");
        btn.className = "px-3 py-2 rounded border border-neutral-700 hover:bg-neutral-800";
        btn.textContent = `Entrar con ${p.label}`;

        btn.addEventListener("click", async () => {
          await sb.auth.signInWithOAuth({
            provider: p.id,
            options: { redirectTo: window.location.href }
          });
        });

        authButtonsEl.appendChild(btn);
      }
    }

    async function setAuthUI() {
      const { data: { session } } = await sb.auth.getSession();
      const isLogged = !!session;

      authUserEl.textContent = isLogged
        ? (session.user.email || "Usuario")
        : "Visitante";

      textEl.disabled = !isLogged;
      fileEl.disabled = !isLogged;
      formEl.querySelector("button[type='submit']").disabled = !isLogged;

      authButtonsEl.classList.toggle("hidden", isLogged);
      logoutBtn.classList.toggle("hidden", !isLogged);
    }

    sb.auth.onAuthStateChange((_event, _session) => {
      setAuthUI();
      loadPosts();
    });

    logoutBtn.addEventListener("click", async () => {
      await sb.auth.signOut();
    });

    async function loadPosts() {
      postsEl.innerHTML = "";

      const { data, error } = await sb
        .from("posts")
        .select("id, text, media_url, media_type, created_at, profiles(username, rank)")
        .order("created_at", { ascending: false })
        .limit(50);

      if (error) {
        postsEl.innerHTML = `<div class="text-red-400">${error.message}</div>`;
        return;
      }

      for (const p of data) {
        const rank = (p.profiles?.rank || "cobre").toLowerCase();

        const RANK_STYLE = {
          cobre: "bg-amber-800/40 text-amber-300 border border-amber-800",
          hierro: "bg-gray-700/40 text-gray-200 border border-gray-700",
          oro: "bg-yellow-700/40 text-yellow-200 border border-yellow-700",
          esmeralda: "bg-emerald-700/40 text-emerald-200 border border-emerald-700",
          diamante: "bg-cyan-700/40 text-cyan-100 border border-cyan-700"
        };

        const badge = RANK_STYLE[rank] || RANK_STYLE.cobre;

        const media = p.media_url
          ? p.media_type.startsWith("video/")
            ? `<video class="w-full rounded" controls src="${p.media_url}"></video>`
            : `<img class="w-full rounded" src="${p.media_url}" />`
          : "";

        const card = document.createElement("article");
        card.className = "border border-neutral-800 rounded-xl overflow-hidden";
        card.innerHTML = `
          <div class="${badge} px-3 py-2 text-xs uppercase">${rank}</div>
          <div class="p-4 space-y-3">
            <div class="text-sm text-neutral-400">${p.profiles?.username || "Usuario"} • ${new Date(p.created_at).toLocaleString()}</div>
            <div class="text-neutral-200 text-sm">${p.text || ""}</div>
            ${media}
          </div>
        `;
        postsEl.appendChild(card);
      }
    }
    formEl.addEventListener("submit", async (e) => {
      e.preventDefault();

      const { data: { session } } = await sb.auth.getSession();
      if (!session) return alert("Debes iniciar sesión.");

      const text = textEl.value.trim();
      if (!text && !fileEl.files[0])
        return alert("Debes escribir algo o subir un archivo.");

      let media_url = null;
      let media_type = null;

      if (fileEl.files[0]) {
        const f = fileEl.files[0];

        const path = `${session.user.id}/${Date.now()}_${f.name}`;

        const { error: uploadErr } = await sb.storage
          .from("posts")
          .upload(path, f, { contentType: f.type });

        if (uploadErr) return alert(uploadErr.message);

        const { data: pub } = sb.storage.from("posts").getPublicUrl(path);
        media_url = pub.publicUrl;
        media_type = f.type;
      }

      const { error: insertErr } = await sb.from("posts").insert({
        user_id: session.user.id,
        text,
        media_url,
        media_type
      });

      if (insertErr) return alert(insertErr.message);

      textEl.value = "";
      fileEl.value = "";
      loadPosts();
    });

    // Init
    (async () => {
      renderAuthButtons();
      await setAuthUI();
      await loadPosts();
    })();
  </script>

</body>
</html>
